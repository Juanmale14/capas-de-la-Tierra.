<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Capas de la Tierra ‚Äî Biling√ºe + Animaciones</title>
<meta name="description" content="Capas internas de la Tierra con botones por capa, flechas se√±alizadas con nombres, animaci√≥n de geodinamo y convecci√≥n, tooltips, locuci√≥n, zoom y selector de idioma (ES/EN)." />
<style>
  :root{
    --bg:#0f172a; --panel:#0b1220; --muted:#94a3b8; --text:#e5e7eb; --brand:#22d3ee; --focus:#fde047;
    --corteza:#9CA3AF; --manto-sup:#FF9E3D; --manto-inf:#F97316; --nucleo-ext:#EA580C; --nucleo-int:#FDE047;
    --atm:#60A5FA; --hid:#22C55E; --lit:#7C3AED;
  }
  html,body{height:100%}
  body{
    margin:0; background: radial-gradient(1200px 800px at 10% 10%, #0a1223, var(--bg));
    color:var(--text); font: 16px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial;
    display:flex; align-items:center; justify-content:center; padding: clamp(12px,2vw,24px);
  }
  .app{ width:min(1250px,100%); display:grid; grid-template-columns: 1.1fr 420px; gap: clamp(16px,3vw,28px); align-items:stretch; }
  @media (max-width: 980px){ .app{ grid-template-columns: 1fr; } }

  /* Tarjeta izquierda */
  .stage{
    background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
    border:1px solid rgba(255,255,255,.08);
    border-radius:16px; padding: clamp(12px,2vw,20px);
    box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
    position:relative;
  }
  .stage h1{ margin:.2rem 0 .2rem; font-weight:700; font-size: clamp(1.2rem, 3vw, 1.8rem); }
  .subtitle{ color:var(--muted); font-size:.95rem; margin:0 0 .5rem; }

  /* Controles superiores */
  .layer-buttons, .chips{ display:flex; flex-wrap:wrap; gap:8px; margin:.4rem 0 .6rem; }
  .layer-btn, .chip{
    --clr: #777;
    display:inline-flex; align-items:center; gap:.5rem; padding:.45rem .7rem;
    background: color-mix(in srgb, var(--clr) 16%, transparent);
    border:1px solid color-mix(in srgb, var(--clr) 50%, transparent);
    color: color-mix(in srgb, var(--clr) 85%, white);
    border-radius:10px; font-size:.92rem; cursor:pointer; user-select:none;
  }
  .layer-btn[data-layer="corteza"]{ --clr: var(--corteza); }
  .layer-btn[data-layer="mantoSuperior"]{ --clr: var(--manto-sup); }
  .layer-btn[data-layer="mantoInferior"]{ --clr: var(--manto-inf); }
  .layer-btn[data-layer="nucleoExterno"]{ --clr: var(--nucleo-ext); }
  .layer-btn[data-layer="nucleoInterno"]{ --clr: var(--nucleo-int); }
  .chip{ --clr: var(--atm); }
  .chip[data-layer="hidrosfera"]{ --clr: var(--hid); }
  .chip[data-layer="litosfera"]{ --clr: var(--lit); }
  .layer-btn:focus-visible,.chip:focus-visible{ outline:2px solid var(--focus); outline-offset:2px; }

  /* Controles de vista */
  .controls{
    display:flex; flex-wrap:wrap; gap:8px 14px; align-items:center;
    padding:.5rem .6rem; border-radius:10px; background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);
    margin:.4rem 0 .8rem;
  }
  .controls label{ display:flex; align-items:center; gap:.45rem; color:var(--muted); font-size:.9rem; }
  .controls input[type="range"]{ width:140px; }
  .controls .sep{ width:1px; height:22px; background:rgba(255,255,255,.12); }
  .controls select{ background:#0b1220; color:var(--text); border:1px solid rgba(255,255,255,.2); border-radius:8px; padding:.35rem .5rem; }

  /* Lienzo */
  .canvas-wrap{ display:grid; place-items:center; position:relative; }
  .earth{ width:min(620px, 100%); height:auto; filter: drop-shadow(0 30px 40px rgba(0,0,0,.45)); }
  .label{ font-family:inherit; font-size:12px; fill:#e5e7eb; paint-order: stroke; stroke:#0b1220; stroke-width:3px; }
  .ring{ cursor:pointer; transition: filter .2s ease, transform .15s ease; }
  .ring:hover{ filter: brightness(1.08) saturate(1.05); }
  .ring:focus-visible{ outline:none; filter: brightness(1.15) saturate(1.1); }
  .arrow{ stroke:#d1d5db; stroke-width:1.6; fill:none; }
  .arrow-head{ fill:#d1d5db; }
  .hot{ cursor:pointer; }

  /* Etiquetas de flecha (nombre de capa al lado) */
  .label-name{ font-weight:700; font-size: 13.5px; fill:#e5e7eb; paint-order: stroke; stroke:#0b1220; stroke-width:4px; }
  .label-shadow{ paint-order: stroke; stroke:#0b1220; stroke-width:4px; }

  /* Animaciones */
  @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
  @keyframes flow { from{ stroke-dashoffset:0 } to{ stroke-dashoffset:-400 } }
  @keyframes float { 0%{ transform:translateY(0) } 50%{ transform:translateY(-2px) } 100%{ transform:translateY(0) } }
  .anim-geodynamo .geo-rotate{ transform-origin: 270px 270px; animation: spin 28s linear infinite; }
  .anim-geodynamo .particle{ animation: float 2.4s ease-in-out infinite; }
  .anim-conv .conv{ stroke-dasharray: 6 8; animation: flow 9s linear infinite; }

  /* Tooltip */
  #tooltip{
    position:absolute; pointer-events:none; background:#0b1220; color:var(--text);
    border:1px solid rgba(255,255,255,.15); border-radius:8px; padding:.35rem .5rem; font-size:.88rem; z-index:5;
    box-shadow: 0 8px 20px rgba(0,0,0,.35);
    transform: translate(-50%, -120%); white-space:nowrap; opacity:0; transition: opacity .12s ease;
  }

  /* Panel derecho */
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,.03), transparent);
    border:1px solid rgba(255,255,255,.1); border-radius:16px; padding: clamp(14px,2vw,20px);
    position:relative; overflow:hidden;
  }
  .toolbar{ position:absolute; top:8px; right:8px; display:flex; gap:6px; }
  .btn{ background:#0b1220; border:1px solid rgba(255,255,255,.1); color:var(--text); border-radius:8px; padding:.4rem .55rem; font-size:.85rem; cursor:pointer; }
  .btn:focus-visible{ outline:2px solid var(--focus); outline-offset:2px; }
  .panel h2{ font-size: clamp(1.1rem, 2.3vw, 1.4rem); margin:.2rem 0 .4rem; }
  .kvs{ display:grid; grid-template-columns: 1fr 1fr; gap:.6rem .8rem; margin:.6rem 0 1rem; }
  .kv{ background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); border-radius:10px; padding:.6rem .7rem; }
  .kv small{ display:block; color:var(--muted); font-size:.75rem; }
  .kv strong{ font-size:.98rem; }
  .desc{ font-size:.98rem; }
  .curio{ margin:.9rem 0 0; font-size:.95rem; color:color-mix(in srgb, var(--brand) 80%, white); border-left:3px solid var(--brand); padding-left:.6rem; }
  .legend{ margin-top: 1rem; display:flex; flex-wrap:wrap; gap:8px; }
  .leg-item{ display:flex; align-items:center; gap:.5rem; font-size:.9rem; color:var(--muted);
             background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); border-radius:999px; padding:.35rem .6rem; }
  .swatch{ width:14px; height:14px; border-radius:50%; border:1px solid rgba(255,255,255,.4); }
  .footer-note{ color:var(--muted); font-size:.8rem; margin-top:.8rem }
</style>
</head>
<body>
  <main class="app" aria-labelledby="titulo">
    <section class="stage" aria-describedby="subtitulo">
      <h1 id="titulo" data-i18n="title">üåç Capas de la Tierra ‚Äî Vista combinada + Animaciones</h1>
      <p id="subtitulo" class="subtitle" data-i18n="subtitle">
        Pulsa un <strong>bot√≥n</strong> o un <strong>anillo</strong>. Activa las animaciones y la locaci√≥n para una experiencia m√°s did√°ctica.
      </p>

      <!-- Botones por capa -->
      <div class="layer-buttons" role="group" aria-label="Capas internas">
        <button class="layer-btn" data-layer="corteza" data-i18n="btn.crust">Corteza</button>
        <button class="layer-btn" data-layer="mantoSuperior" data-i18n="btn.upperMantle">Manto superior</button>
        <button class="layer-btn" data-layer="mantoInferior" data-i18n="btn.lowerMantle">Manto inferior</button>
        <button class="layer-btn" data-layer="nucleoExterno" data-i18n="btn.outerCore">N√∫cleo externo</button>
        <button class="layer-btn" data-layer="nucleoInterno" data-i18n="btn.innerCore">N√∫cleo interno</button>
      </div>

      <!-- Superficie -->
      <div class="chips" role="list" aria-label="Capas superficiales">
        <button class="chip" role="listitem" data-layer="atm√≥sfera" data-i18n="chip.atm">‚òÅÔ∏è Atm√≥sfera</button>
        <button class="chip" role="listitem" data-layer="hidrosfera" data-i18n="chip.hyd">üåä Hidrosfera</button>
        <button class="chip" role="listitem" data-layer="litosfera" data-i18n="chip.lith">‚õ∞Ô∏è Litosfera</button>
      </div>

      <!-- Controles de vista -->
      <div class="controls" aria-label="Opciones de visualizaci√≥n">
        <label><input type="checkbox" id="toggleArrows" checked> <span data-i18n="opt.arrows">Flechas/etiquetas</span></label>
        <label><input type="checkbox" id="toggleGeo" checked> <span data-i18n="opt.geo">Animar geodinamo</span></label>
        <label><input type="checkbox" id="toggleConv" checked> <span data-i18n="opt.conv">Animar convecci√≥n</span></label>
        <span class="sep" aria-hidden="true"></span>
        <label><span data-i18n="opt.zoom">Zoom</span> <input type="range" id="zoomRange" min="80" max="160" value="100"> <span id="zoomVal">100%</span></label>
        <span class="sep" aria-hidden="true"></span>
        <label><input type="checkbox" id="toggleVoice"> <span data-i18n="opt.voice">Locuci√≥n</span></label>
        <label><input type="checkbox" id="toggleExpert"> <span data-i18n="opt.expert">Modo experto</span></label>
        <span class="sep" aria-hidden="true"></span>
        <label for="langSelect" data-i18n="opt.lang">Idioma</label>
        <select id="langSelect" aria-label="Idioma">
          <option value="es">ES</option>
          <option value="en">EN</option>
        </select>
        <button class="btn" id="resetBtn" title="Restablecer vista" data-i18n="btn.resetTitle">Reset</button>
      </div>

      <!-- Tooltip -->
      <div id="tooltip" role="status" aria-hidden="true"></div>

      <!-- Diagrama -->
      <div class="canvas-wrap" id="canvasWrap" aria-live="polite">
        <svg class="earth" id="earth" viewBox="0 0 900 540" role="img"
             aria-label="Planeta Tierra, mitad real y mitad corte interno con animaciones y flechas">
          <defs>
            <radialGradient id="oceanGrad" cx="30%" cy="30%">
              <stop offset="0%" stop-color="#2dd4bf"/><stop offset="60%" stop-color="#0ea5e9"/><stop offset="100%" stop-color="#0a74c4"/>
            </radialGradient>
            <linearGradient id="shine" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="rgba(255,255,255,0.6)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></linearGradient>
            <radialGradient id="shade" cx="70%" cy="70%"><stop offset="0%" stop-color="rgba(0,0,0,0)"/><stop offset="100%" stop-color="rgba(0,0,0,0.25)"/></radialGradient>
            <!-- Gradientes de anillos -->
            <linearGradient id="g-corteza" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#BFC5CE"/><stop offset="100%" stop-color="#9CA3AF"/></linearGradient>
            <linearGradient id="g-manto-sup" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#FFB86B"/><stop offset="100%" stop-color="#FF9E3D"/></linearGradient>
            <linearGradient id="g-manto-inf" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#FB923C"/><stop offset="100%" stop-color="#F97316"/></linearGradient>
            <linearGradient id="g-nucleo-ext" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#F97316"/><stop offset="100%" stop-color="#EA580C"/></linearGradient>
            <linearGradient id="g-nucleo-int" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#FFF176"/><stop offset="100%" stop-color="#FDE047"/></linearGradient>
            <!-- Punta de flecha -->
            <marker id="arrowHead" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
              <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-head"/>
            </marker>
          </defs>

          <!-- Grupo "mundo" para zoom -->
          <g id="world" transform="translate(270,270) scale(1)">
            <!-- Disco base + sombreado -->
            <circle r="240" fill="url(#oceanGrad)"/><circle r="240" fill="url(#shade)"/>

            <!-- Mitad izquierda (real) -->
            <clipPath id="clipLeft"><rect x="-240" y="-240" width="240" height="480"/></clipPath>
            <g clip-path="url(#clipLeft)" opacity="0.85">
              <path d="M -30,-110 C -60,-130 -120,-120 -150,-90 C -170,-60 -160,-10 -130,10 C -100,30 -70,40 -40,20 C -10,5 10,-30 -10,-60 Z" fill="#34d399"/>
              <path d="M -160,70 C -140,85 -120,100 -110,120 C -120,130 -150,125 -170,110 C -185,95 -180,80 -160,70 Z" fill="#22c55e"/>
              <circle cx="-80" cy="-150" r="14" fill="#22c55e"/>
            </g>

            <!-- Mitad derecha (corte) -->
            <clipPath id="clipRight"><rect x="0" y="-240" width="240" height="480"/></clipPath>
            <g clip-path="url(#clipRight)" id="cut">
              <!-- Convecci√≥n del manto (trayectorias) -->
              <g class="conv" stroke="rgba(255,255,255,.35)" fill="none">
                <path d="M 90,-170 q 20,40 0,80 q -20,40 0,80" />
                <path d="M 135,-150 q 18,36 0,72 q -18,36 0,72" />
                <path d="M 60,-120 q 22,44 0,88 q -22,44 0,88" />
                <path d="M 170,-130 q 18,36 0,72 q -18,36 0,72" />
              </g>

              <!-- Anillos -->
              <path class="ring" tabindex="0" data-layer="corteza" fill="url(#g-corteza)"
                d="M0,-240 A240,240 0 0,1 240,0 A240,240 0 0,1 0,240 L 0,212 A212,212 0 0,0 212,0 A212,212 0 0,0 0,-212 Z"/>
              <path class="ring" tabindex="0" data-layer="mantoSuperior" fill="url(#g-manto-sup)"
                d="M0,-212 A212,212 0 0,1 212,0 A212,212 0 0,1 0,212 L 0,180 A180,180 0 0,0 180,0 A180,180 0 0,0 0,-180 Z"/>
              <path class="ring" tabindex="0" data-layer="mantoInferior" fill="url(#g-manto-inf)"
                d="M0,-180 A180,180 0 0,1 180,0 A180,180 0 0,1 0,180 L 0,75 A75,75 0 0,0 75,0 A75,75 0 0,0 0,-75 Z"/>

              <!-- N√∫cleo externo con convecci√≥n -->
              <g id="outerCore">
                <path class="ring" tabindex="0" data-layer="nucleoExterno" fill="url(#g-nucleo-ext)"
                  d="M0,-75 A75,75 0 0,1 75,0 A75,75 0 0,1 0,75 L 0,38 A38,38 0 0,0 38,0 A38,38 0 0,0 0,-38 Z"/>
                <g class="conv" stroke="rgba(255,255,255,.5)" fill="none">
                  <path d="M 25,-50 q 10,16 0,32 q -10,16 0,32" />
                  <path d="M 50,-40 q 8,14 0,28 q -8,14 0,28" />
                </g>
              </g>

              <!-- N√∫cleo interno + geodinamo (l√≠neas de campo) -->
              <g id="innerCore">
                <path class="ring" tabindex="0" data-layer="nucleoInterno" fill="url(#g-nucleo-int)"
                  d="M0,-38 A38,38 0 0,1 38,0 A38,38 0 0,1 0,38 L 0,0 Z"/>
                <!-- Grupo que rota para simular geodinamo -->
                <g class="geo-rotate">
                  <!-- L√≠neas de campo (semic√≠rculos) -->
                  <g stroke="rgba(255,255,255,.45)" fill="none">
                    <path d="M 0,0 m 0,-50 a 50,50 0 0,1 0,100" />
                    <path d="M 0,0 m 12,-60 a 62,62 0 0,1 0,120" />
                    <path d="M 0,0 m -12,-60 a 62,62 0 0,0 0,120" />
                    <path d="M 0,0 m 22,-72 a 74,74 0 0,1 0,148" />
                  </g>
                  <!-- Part√≠culas sobre l√≠neas (visual de ‚Äúflujo‚Äù) -->
                  <circle class="particle" cx="0" cy="-50" r="1.8" fill="#fff"/>
                  <circle class="particle" cx="12" cy="-60" r="1.6" fill="#fff" style="animation-delay:.4s"/>
                  <circle class="particle" cx="-12" cy="-60" r="1.6" fill="#fff" style="animation-delay:.8s"/>
                  <circle class="particle" cx="22" cy="-72" r="1.4" fill="#fff" style="animation-delay:1.2s"/>
                </g>
              </g>

              <!-- Flechas + nombres (hotspots con tooltip) -->
              <g id="labels" class="label" font-size="13">
                <g class="hot" data-layer="corteza">
                  <path class="arrow" d="M 245,-210 L 200,-210 L 168,-210" marker-end="url(#arrowHead)"/>
                  <text class="label-name" x="248" y="-206" id="lab-crust">Corteza</text>
                </g>
                <g class="hot" data-layer="mantoSuperior">
                  <path class="arrow" d="M 260,-150 L 205,-150 L 190,-150" marker-end="url(#arrowHead)"/>
                  <text class="label-name" x="263" y="-146" id="lab-upper">Manto superior</text>
                </g>
                <g class="hot" data-layer="mantoInferior">
                  <path class="arrow" d="M 270,-85 L 205,-85 L 170,-85" marker-end="url(#arrowHead)"/>
                  <text class="label-name" x="273" y="-81" id="lab-lower">Manto inferior</text>
                </g>
                <g class="hot" data-layer="nucleoExterno">
                  <path class="arrow" d="M 250,-30 L 190,-30 L 125,-30" marker-end="url(#arrowHead)"/>
                  <text class="label-name" x="253" y="-26" id="lab-outer">N√∫cleo externo</text>
                </g>
                <g class="hot" data-layer="nucleoInterno">
                  <path class="arrow" d="M 240,10 L 150,10 L 108,10" marker-end="url(#arrowHead)"/>
                  <text class="label-name" x="243" y="14" id="lab-inner">N√∫cleo interno</text>
                </g>
              </g>
            </g>

            <!-- Brillos -->
            <ellipse rx="200" ry="200" fill="url(#shine)" opacity=".15"/>
          </g>
        </svg>
      </div>
    </section>

    <!-- Panel de informaci√≥n -->
    <aside class="panel" aria-live="polite">
      <div class="toolbar">
        <button class="btn" id="prevBtn" aria-label="Capa anterior">‚ü®</button>
        <button class="btn" id="nextBtn" aria-label="Capa siguiente">‚ü©</button>
        <button class="btn" id="speakBtn" title="Reproducir locuci√≥n">üîä</button>
      </div>

      <h2 id="layerTitle">Bienvenido al Explorador</h2>
      <div class="kvs" id="kvGrid" aria-hidden="true"></div>
      <p class="desc" id="layerDesc">Pulsa un bot√≥n o un anillo para abrir la ficha ampliada de cada capa.</p>
      <p class="curio" id="layerCurio" style="display:none"></p>

      <div class="legend" aria-label="Leyenda">
        <span class="leg-item"><span class="swatch" style="background:var(--corteza)"></span> <span data-i18n="leg.crust">Corteza</span></span>
        <span class="leg-item"><span class="swatch" style="background:var(--manto-sup)"></span> <span data-i18n="leg.upper">Manto sup.</span></span>
        <span class="leg-item"><span class="swatch" style="background:var(--manto-inf)"></span> <span data-i18n="leg.lower">Manto inf.</span></span>
        <span class="leg-item"><span class="swatch" style="background:var(--nucleo-ext)"></span> <span data-i18n="leg.outer">N√∫cleo externo</span></span>
        <span class="leg-item"><span class="swatch" style="background:var(--nucleo-int)"></span> <span data-i18n="leg.inner">N√∫cleo interno</span></span>
      </div>
      <p class="footer-note" data-i18n="footer.tip">Sugerencia: usa <kbd>Tab</kbd> para enfocar anillos o flechas, <kbd>Enter</kbd> para abrir su ficha.</p>
    </aside>
  </main>

  <script>
    // i18n UI y capas (ES/EN)
    const i18n = {
      es: {
        ui: {
          title: "üåç Capas de la Tierra ‚Äî Vista combinada + Animaciones",
          subtitle: "Pulsa un <strong>bot√≥n</strong> o un <strong>anillo</strong>. Activa las animaciones y la locaci√≥n para una experiencia m√°s did√°ctica.",
          "btn.crust":"Corteza","btn.upperMantle":"Manto superior","btn.lowerMantle":"Manto inferior","btn.outerCore":"N√∫cleo externo","btn.innerCore":"N√∫cleo interno",
          "chip.atm":"‚òÅÔ∏è Atm√≥sfera","chip.hyd":"üåä Hidrosfera","chip.lith":"‚õ∞Ô∏è Litosfera",
          "opt.arrows":"Flechas/etiquetas","opt.geo":"Animar geodinamo","opt.conv":"Animar convecci√≥n","opt.zoom":"Zoom","opt.voice":"Locuci√≥n","opt.expert":"Modo experto","opt.lang":"Idioma",
          "btn.resetTitle":"Reset",
          "leg.crust":"Corteza","leg.upper":"Manto sup.","leg.lower":"Manto inf.","leg.outer":"N√∫cleo externo","leg.inner":"N√∫cleo interno",
          "footer.tip":"Sugerencia: usa <kbd>Tab</kbd> para enfocar anillos o flechas, <kbd>Enter</kbd> para abrir su ficha.",
          "label.crust":"Corteza","label.upper":"Manto superior","label.lower":"Manto inferior","label.outer":"N√∫cleo externo","label.inner":"N√∫cleo interno",
          "tip.click":"clic para ver ficha","tip.zoom":"Zoom"
        },
        layers: [
          { id:"corteza", titulo:"Corteza",
            kvs:[["Espesor t√≠pico","Oce√°nica ~5‚Äì10 km; Continental ~30‚Äì40 km; hasta ~70‚Äì100 km bajo or√≥genos"],
                 ["Porcentaje","Volumen ‚âà 1‚Äì1.4% ¬∑ Masa ‚âà 0.4%"],
                 ["Densidad","‚âà 2.7 g/cm¬≥ (continental) ¬∑ 2.9‚Äì3.0 g/cm¬≥ (oce√°nica)"],
                 ["Composici√≥n","Silicatos: granitos (continental), basaltos (oce√°nica); l√≠mite con manto = Moho"]],
            desc:"La corteza es la piel del planeta: r√≠gida, fr√°gil y muy delgada. Se fractura en placas que flotan sobre el manto superior.",
            curio:"Bajo los grandes sistemas monta√±osos, el Moho puede descender cerca de 70‚Äì100 km."
          },
          { id:"mantoSuperior", titulo:"Manto superior",
            kvs:[["Profundidad","‚âà 35‚Äì660 km (litosfera + astenosfera + zona de transici√≥n 410‚Äì660 km)"],
                 ["Porcentaje","Parte del manto que junto al inferior suma ‚âà 84% del volumen terrestre"],
                 ["Densidad","‚âà 3.3‚Äì3.9 g/cm¬≥ (creciente con profundidad)"],
                 ["Composici√≥n","Olivino, piroxenos; en transici√≥n: wadsleyita/ringwoodita (cambios de fase)"]],
            desc:"S√≥lido que puede fluir a largo plazo. La astenosfera act√∫a como ‚Äúcinta transportadora‚Äù para las placas. La zona 410‚Äì660 km marca cambios de fase mineral.",
            curio:"La mayor parte del basalto oce√°nico se origina por fusi√≥n parcial del manto superior bajo las dorsales."
          },
          { id:"mantoInferior", titulo:"Manto inferior",
            kvs:[["Profundidad","‚âà 660‚Äì2.900 km"],
                 ["Porcentaje","‚âà 56% del volumen de la Tierra"],
                 ["Densidad","‚âà 4.4‚Äì5.6 g/cm¬≥ (aumenta con la profundidad)"],
                 ["Composici√≥n","Bridgmanita, ferropericlasa y Ca-silicato perovskita (alta presi√≥n)"]],
            desc:"S√≥lido y convectivo; controla gran parte del transporte de calor interno. Las mega-plumas t√©rmicas pueden partir de la base del manto (zona D ∫).",
            curio:"Aunque es s√≥lido, la roca fluye con tiempos geol√≥gicos: se deforma pl√°sticamente durante millones de a√±os."
          },
          { id:"nucleoExterno", titulo:"N√∫cleo externo",
            kvs:[["Profundidad","‚âà 2.900‚Äì5.150 km"],
                 ["Porcentaje","Mayor parte del volumen del n√∫cleo (n√∫cleo total ‚âà 16% del volumen terrestre)"],
                 ["Densidad","‚âà 9.9‚Äì12.2 g/cm¬≥ (Fe‚ÄìNi l√≠quido con elementos ligeros)"],
                 ["Funci√≥n","Convecci√≥n met√°lica que genera el campo magn√©tico (geodinamo)"]],
            desc:"Un oc√©ano de hierro l√≠quido que hierve lentamente. Sus corrientes, combinadas con la rotaci√≥n de la Tierra, mantienen el campo magn√©tico.",
            curio:"Las inversiones del campo magn√©tico han ocurrido muchas veces; durante la transici√≥n, el campo se debilita y se reorganiza."
          },
          { id:"nucleoInterno", titulo:"N√∫cleo interno",
            kvs:[["Profundidad","‚âà 5.150‚Äì6.371 km (radio ~1.220 km)"],
                 ["Porcentaje","Peque√±a fracci√≥n del volumen, pero muy densa"],
                 ["Densidad","‚âà 12.8‚Äì13.1 g/cm¬≥ (Fe mayoritario, con Ni y ligeros)"],
                 ["Caracter√≠sticas","S√≥lido por presi√≥n; anisotrop√≠a cristalina; posible rotaci√≥n diferencial"]],
            desc:"Esfera s√≥lida de hierro comprimida por presiones colosales. Aun tan caliente, permanece s√≥lida debido a la presi√≥n.",
            curio:"Estudios s√≠smicos sugieren ligera rotaci√≥n diferencial respecto al manto y anisotrop√≠a del hierro."
          },
          { id:"atm√≥sfera", pill:true, titulo:"Atm√≥sfera", kvs:[["Extensi√≥n","~0‚Äì100 km (capas principales)"],["Funci√≥n","Protecci√≥n radiativa y regulaci√≥n clim√°tica"]],
            desc:"Mezcla gaseosa esencial para clima y vida.", curio:"La presi√≥n a nivel del mar equivale a ~10 m de agua sobre ti." },
          { id:"hidrosfera", pill:true, titulo:"Hidrosfera", kvs:[["Cobertura","~71% de la superficie"],["Reserva","~97% salada; ~3% dulce"]],
            desc:"Aguas l√≠quidas, s√≥lidas y gaseosas del planeta.", curio:"Los oc√©anos lubrican la tect√≥nica y modulan el clima." },
          { id:"litosfera", pill:true, titulo:"Litosfera", kvs:[["Composici√≥n","Corteza + manto superior r√≠gido"],["Din√°mica","Placas sobre la astenosfera"]],
            desc:"Capa ‚Äúdura‚Äù donde viajan las placas tect√≥nicas.", curio:"La litosfera oce√°nica se recicla en ~200 Ma; la continental dura eones." }
        ]
      },

      en: {
        ui: {
          title: "üåç Earth's Layers ‚Äî Combined View + Animations",
          subtitle: "Click a <strong>button</strong> or a <strong>ring</strong>. Enable animations and narration for a richer experience.",
          "btn.crust":"Crust","btn.upperMantle":"Upper mantle","btn.lowerMantle":"Lower mantle","btn.outerCore":"Outer core","btn.innerCore":"Inner core",
          "chip.atm":"‚òÅÔ∏è Atmosphere","chip.hyd":"üåä Hydrosphere","chip.lith":"‚õ∞Ô∏è Lithosphere",
          "opt.arrows":"Arrows/labels","opt.geo":"Animate geodynamo","opt.conv":"Animate convection","opt.zoom":"Zoom","opt.voice":"Narration","opt.expert":"Expert mode","opt.lang":"Language",
          "btn.resetTitle":"Reset",
          "leg.crust":"Crust","leg.upper":"Upper mant.","leg.lower":"Lower mant.","leg.outer":"Outer core","leg.inner":"Inner core",
          "footer.tip":"Tip: use <kbd>Tab</kbd> to focus rings or arrows, <kbd>Enter</kbd> to open the card.",
          "label.crust":"Crust","label.upper":"Upper mantle","label.lower":"Lower mantle","label.outer":"Outer core","label.inner":"Inner core",
          "tip.click":"click to open","tip.zoom":"Zoom"
        },
        layers: [
          { id:"corteza", titulo:"Crust",
            kvs:[["Typical thickness","Oceanic ~5‚Äì10 km; Continental ~30‚Äì40 km; up to ~70‚Äì100 km under orogens"],
                 ["Percentage","Volume ‚âà 1‚Äì1.4% ¬∑ Mass ‚âà 0.4%"],
                 ["Density","‚âà 2.7 g/cm¬≥ (continental) ¬∑ 2.9‚Äì3.0 g/cm¬≥ (oceanic)"],
                 ["Composition","Silicates: granitic (continental), basaltic (oceanic); boundary with mantle = Moho"]],
            desc:"The planet‚Äôs ‚Äòskin‚Äô: rigid, brittle and very thin. It breaks into plates that float atop the upper mantle.",
            curio:"Beneath major mountain belts, the Moho can reach ~70‚Äì100 km depth."
          },
          { id:"mantoSuperior", titulo:"Upper mantle",
            kvs:[["Depth","‚âà 35‚Äì660 km (lithosphere + asthenosphere + 410‚Äì660 km transition)"],
                 ["Percentage","Together with the lower mantle ‚âà 84% of Earth‚Äôs volume"],
                 ["Density","‚âà 3.3‚Äì3.9 g/cm¬≥ (increasing with depth)"],
                 ["Composition","Olivine, pyroxenes; transition: wadsleyite/ringwoodite (phase changes)"]],
            desc:"Solid that can flow on geologic timescales. The asthenosphere acts as a conveyor belt for plates. 410‚Äì660 km marks key phase transitions.",
            curio:"Most mid-ocean ridge basalts originate from partial melting of the upper mantle."
          },
          { id:"mantoInferior", titulo:"Lower mantle",
            kvs:[["Depth","‚âà 660‚Äì2,900 km"],
                 ["Percentage","‚âà 56% of Earth‚Äôs volume"],
                 ["Density","‚âà 4.4‚Äì5.6 g/cm¬≥ (increasing with depth)"],
                 ["Composition","Bridgmanite, ferropericlase and Ca-silicate perovskite (high-pressure assemblage)"]],
            desc:"Solid and convective; it transports much of Earth‚Äôs internal heat. Superplumes may rise from the D ∫ region near the CMB.",
            curio:"Rock flows under immense pressure over millions of years‚Äîdespite being solid."
          },
          { id:"nucleoExterno", titulo:"Outer core",
            kvs:[["Depth","‚âà 2,900‚Äì5,150 km"],
                 ["Percentage","Most of the core‚Äôs volume (core total ‚âà 16% of Earth‚Äôs volume)"],
                 ["Density","‚âà 9.9‚Äì12.2 g/cm¬≥ (liquid Fe‚ÄìNi with light elements)"],
                 ["Role","Metallic convection generates the geomagnetic field (geodynamo)"]],
            desc:"A slowly ‚Äòboiling‚Äô ocean of liquid iron. Its motion, together with Earth‚Äôs rotation, sustains the magnetic field.",
            curio:"Field reversals have occurred many times; during transitions the field weakens and reorganizes."
          },
          { id:"nucleoInterno", titulo:"Inner core",
            kvs:[["Depth","‚âà 5,150‚Äì6,371 km (radius ~1,220 km)"],
                 ["Percentage","Small in volume, very dense"],
                 ["Density","‚âà 12.8‚Äì13.1 g/cm¬≥ (mostly Fe with Ni and light elements)"],
                 ["Features","Solid due to pressure; crystalline anisotropy; possible differential rotation"]],
            desc:"A solid iron sphere compressed by colossal pressures. Despite high temperature, it remains solid.",
            curio:"Seismic studies suggest slight differential rotation and iron anisotropy."
          },
          { id:"atm√≥sfera", pill:true, titulo:"Atmosphere",
            kvs:[["Extent","~0‚Äì100 km (main layers)"],["Function","Radiative protection & climate regulation"]],
            desc:"Gas mixture essential for climate and life.", curio:"Sea-level pressure equals ~10 m of water overhead." },
          { id:"hidrosfera", pill:true, titulo:"Hydrosphere",
            kvs:[["Coverage","~71% of surface"],["Storage","~97% saline; ~3% fresh"]],
            desc:"Earth‚Äôs water in liquid, solid and gas.", curio:"Oceans lubricate plate tectonics and modulate climate." },
          { id:"litosfera", pill:true, titulo:"Lithosphere",
            kvs:[["Composition","Crust + rigid upper mantle"],["Dynamics","Plates on top of the asthenosphere"]],
            desc:"Rigid ‚Äòshell‚Äô carrying tectonic plates.", curio:"Oceanic lithosphere recycles in ~200 Ma; continental endures eons." }
        ]
      }
    };

    const ringOrder = ["corteza","mantoSuperior","mantoInferior","nucleoExterno","nucleoInterno"];
    const state = { arrows:true, geodynamo:true, convection:true, zoom:1, voice:false, expert:false, current:"mantoSuperior" };

    const earth = document.getElementById('earth');
    const world = document.getElementById('world');
    const labels = document.getElementById('labels');
    const tooltip = document.getElementById('tooltip');
    const titleEl = document.getElementById('layerTitle');
    const gridEl  = document.getElementById('kvGrid');
    const descEl  = document.getElementById('layerDesc');
    const curioEl = document.getElementById('layerCurio');

    let lang = 'es';

    function getLayerData(id){ return i18n[lang].layers.find(l=>l.id===id); }

    function render(layerId){
      const data = getLayerData(layerId);
      if(!data) return;
      state.current = layerId;
      titleEl.textContent = data.titulo;
      descEl.textContent = data.desc;
      curioEl.style.display = data.curio ? "block":"none";
      curioEl.textContent = data.curio || "";
      gridEl.innerHTML = ""; gridEl.setAttribute("aria-hidden","false");
      const kvList = state.expert ? (data.kvs||[]) : (data.kvs||[]).slice(0,3);
      kvList.forEach(([k,v])=>{
        const div = document.createElement('div');
        div.className = 'kv';
        div.innerHTML = `<small>${k}</small><strong>${v}</strong>`;
        gridEl.appendChild(div);
      });
      document.querySelectorAll('.ring').forEach(r=>{
        r.style.transform = (r.dataset.layer === layerId) ? "translateX(4px) scale(1.02)" : "none";
        r.style.filter     = (r.dataset.layer === layerId) ? "brightness(1.15) saturate(1.1)" : "";
      });
      document.querySelectorAll('.layer-btn').forEach(b=>{
        b.style.outline = (b.dataset.layer === layerId) ? "2px solid var(--focus)" : "none";
      });
      if(state.voice) speakLayer(layerId);
    }

    function speakLayer(layerId){
      try{
        const data = getLayerData(layerId);
        if(!data) return;
        window.speechSynthesis.cancel();
        const kvText = (data.kvs||[]).map(([k,v])=>`${k}: ${v}.`).join(" ");
        const text = `${data.titulo}. ${data.desc} ${kvText} ${data.curio? (lang==="es"?"Curiosidad: ":"Fun fact: ")+data.curio: ""}`;
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = lang==="es" ? "es-ES" : "en-US";
        utter.rate = 1; utter.pitch = 1;
        window.speechSynthesis.speak(utter);
      }catch(e){}
    }

    function showTip(text, x, y){
      tooltip.innerHTML = text; tooltip.style.left = x+"px"; tooltip.style.top = y+"px"; tooltip.style.opacity = "1"; tooltip.setAttribute("aria-hidden","false");
    }
    function hideTip(){ tooltip.style.opacity = "0"; tooltip.setAttribute("aria-hidden","true"); }

    function attachHotspots(){
      document.querySelectorAll('.hot').forEach(h=>{
        h.addEventListener('mousemove', e=>{
          const rect = document.getElementById('canvasWrap').getBoundingClientRect();
          const ln = i18n[lang].ui; const lid = h.dataset.layer;
          const name = ({corteza: ln["label.crust"], mantoSuperior: ln["label.upper"], mantoInferior: ln["label.lower"], nucleoExterno: ln["label.outer"], nucleoInterno: ln["label.inner"]})[lid];
          showTip(`üí° ${name}: ${ln["tip.click"]}`, e.clientX-rect.left, e.clientY-rect.top);
        });
        h.addEventListener('mouseleave', hideTip);
        h.addEventListener('click', ()=> render(h.dataset.layer));
        h.addEventListener('keydown', (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); render(h.dataset.layer);} });
        h.setAttribute('tabindex','0');
      });
      document.querySelectorAll('.ring').forEach(r=>{
        r.addEventListener('mousemove', e=>{
          const rect = document.getElementById('canvasWrap').getBoundingClientRect();
          const ln = i18n[lang].ui; const lid = r.dataset.layer;
          const name = ({corteza: ln["label.crust"], mantoSuperior: ln["label.upper"], mantoInferior: ln["label.lower"], nucleoExterno: ln["label.outer"], nucleoInterno: ln["label.inner"]})[lid] || lid;
          showTip(`üîé ${name}: ${ln["tip.click"]}`, e.clientX-rect.left, e.clientY-rect.top);
        });
        r.addEventListener('mouseleave', hideTip);
        r.addEventListener('click', e=> render(e.currentTarget.dataset.layer));
        r.addEventListener('keydown', e=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); render(e.currentTarget.dataset.layer);} });
      });
    }

    attachHotspots();

    document.getElementById('prevBtn').addEventListener('click', ()=>{
      const i = ringOrder.indexOf(state.current); const idx = i>=0 ? (i - 1 + ringOrder.length) % ringOrder.length : 0; render(ringOrder[idx]);
    });
    document.getElementById('nextBtn').addEventListener('click', ()=>{
      const i = ringOrder.indexOf(state.current); const idx = i>=0 ? (i + 1) % ringOrder.length : 0; render(ringOrder[idx]);
    });
    document.getElementById('speakBtn').addEventListener('click', ()=> speakLayer(state.current));

    function applyAnimClasses(){
      earth.classList.toggle('anim-geodynamo', state.geodynamo);
      earth.classList.toggle('anim-conv', state.convection);
      labels.style.display = state.arrows ? "block":"none";
    }
    document.getElementById('toggleArrows').addEventListener('change', (e)=>{ state.arrows = e.target.checked; applyAnimClasses(); });
    document.getElementById('toggleGeo').addEventListener('change', (e)=>{ state.geodynamo = e.target.checked; applyAnimClasses(); });
    document.getElementById('toggleConv').addEventListener('change', (e)=>{ state.convection = e.target.checked; applyAnimClasses(); });
    document.getElementById('toggleVoice').addEventListener('change', (e)=>{ state.voice = e.target.checked; if(state.voice) speakLayer(state.current); else window.speechSynthesis?.cancel(); });
    document.getElementById('toggleExpert').addEventListener('change', (e)=>{ state.expert = e.target.checked; render(state.current); });

    const zoomRange = document.getElementById('zoomRange'); const zoomVal = document.getElementById('zoomVal');
    zoomRange.addEventListener('input', (e)=>{
      const z = e.target.value/100; state.zoom = z; world.setAttribute('transform', `translate(270,270) scale(${z})`);
      const ln = i18n[lang].ui; zoomVal.textContent = Math.round(z*100)+"%"; zoomVal.setAttribute('aria-label', ln["opt.zoom"] + " " + zoomVal.textContent);
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      state.arrows = true; state.geodynamo = true; state.convection = true; state.zoom = 1; state.voice = false; state.expert = false;
      document.getElementById('toggleArrows').checked = true;
      document.getElementById('toggleGeo').checked = true;
      document.getElementById('toggleConv').checked = true;
      document.getElementById('toggleVoice').checked = false;
      document.getElementById('toggleExpert').checked = false;
      zoomRange.value = 100; zoomVal.textContent = "100%"; world.setAttribute('transform', `translate(270,270) scale(1)`);
      applyAnimClasses();
    });

    const langSelect = document.getElementById('langSelect');
    function applyLang(){
      const t = i18n[lang].ui;
      document.querySelectorAll('[data-i18n]').forEach(el=>{ const key = el.getAttribute('data-i18n'); if(t[key] !== undefined) el.innerHTML = t[key]; });
      document.getElementById('lab-crust').textContent = t["label.crust"];
      document.getElementById('lab-upper').textContent = t["label.upper"];
      document.getElementById('lab-lower').textContent = t["label.lower"];
      document.getElementById('lab-outer').textContent = t["label.outer"];
      document.getElementById('lab-inner').textContent = t["label.inner"];
      render(state.current);
    }
    langSelect.addEventListener('change', (e)=>{ lang = e.target.value; applyLang(); });

    applyAnimClasses(); attachHotspots(); render("mantoSuperior"); applyLang();
  </script>

  <!-- Fuentes: USGS, USGS Geodinamo, Britannica, NASA; ver README.md -->
</body>
</html>
